–û—Å—å –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –¥–æ —Ç–≤–æ–≥–æ –∫–ª–∞—Å—É `PersonalizationEngine`. –í–æ–Ω–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞ —É —Ñ–æ—Ä–º–∞—Ç—ñ `README.md`, —è–∫–∏–π —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è GitHub, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—ó –Ω–∞ —Ö–∞–∫–∞—Ç–æ–Ω—ñ –∞–±–æ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –∫–æ–ª–µ–≥–∞–º.

–Ø —Ä–æ–∑–±–∏–≤ —ó—ó –Ω–∞ –∑—Ä–æ–∑—É–º—ñ–ª—ñ –±–ª–æ–∫–∏: **–©–æ —Ü–µ**, **–Ø–∫ –ø—Ä–∞—Ü—é—î**, **–í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ**, **–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è** —Ç–∞ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ**.

---

# üß† Personalization Engine (–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è)

**PersonalizationEngine** ‚Äî —Ü–µ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏–π –º–æ–¥—É–ª—å, —è–∫–∏–π —Ñ–æ—Ä–º—É—î –¥–µ—Ç–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —É—á–Ω—è –¥–ª—è AI-—Ç—å—é—Ç–æ—Ä–∞. –í—ñ–Ω –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î "—Å–∏—Ä—ñ" –¥–∞–Ω—ñ –∑ –∂—É—Ä–Ω–∞–ª—É (–æ—Ü—ñ–Ω–∫–∏ —Ç–∞ –ø—Ä–æ–ø—É—Å–∫–∏) –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—É —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –Ω–∞–≤—á–∞–Ω–Ω—è.

## ‚ú® –ö–ª—é—á–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

1. **Semantic Topic Matching:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î NLP (TF-IDF + Cosine Similarity) –¥–ª—è –ø–æ—à—É–∫—É —Ç–µ–º —É –∂—É—Ä–Ω–∞–ª—ñ, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —ó—Ö –Ω–∞–∑–≤–∏ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å –¥–æ—Å–ª—ñ–≤–Ω–æ —ñ–∑ –∑–∞–ø–∏—Ç–æ–º.
2. **Hybrid Context Logic:** –ê–Ω–∞–ª—ñ–∑—É—î –æ–¥–Ω–æ—á–∞—Å–Ω–æ **—É—Å–ø—ñ—à–Ω—ñ—Å—Ç—å** (–æ—Ü—ñ–Ω–∫–∏) —Ç–∞ **–ø–æ–≤–µ–¥—ñ–Ω–∫—É** (–ø—Ä–æ–ø—É—Å–∫–∏).
3. **Adaptive Fallback:** –Ø–∫—â–æ –¥–∞–Ω–∏—Ö –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ–π —Ç–µ–º—ñ –Ω–µ–º–∞—î, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–º–∏–∫–∞—î—Ç—å—Å—è –Ω–∞ –∞–Ω–∞–ª—ñ–∑ –∑–∞–≥–∞–ª—å–Ω–æ—ó —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ –∑ –ø—Ä–µ–¥–º–µ—Ç—É.
4. **Enrichment:** –ì–µ–Ω–µ—Ä—É—î –Ω–µ —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM, –∞ –π —á–∏—Å—Ç—ñ –¥–∞–Ω—ñ (JSON) –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –Ω–∞ UI.

---

## üì¶ 1. –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö (Input Data)

–ö–ª–∞—Å –ø—Ä–∏–π–º–∞—î –¥–≤–∞ Pandas DataFrames. –í–æ–Ω–∏ –ø–æ–≤–∏–Ω–Ω—ñ –º—ñ—Å—Ç–∏—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–æ–ª–æ–Ω–∫–∏:

### `df_scores` (–û—Ü—ñ–Ω–∫–∏)

| –ö–æ–ª–æ–Ω–∫–∞           | –¢–∏–ø         | –û–ø–∏—Å                                    |
| ----------------- | ----------- | --------------------------------------- |
| `student_id`      | `int`       | –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID —É—á–Ω—è                      |
| `discipline_name` | `str`       | –ù–∞–∑–≤–∞ –ø—Ä–µ–¥–º–µ—Ç—É (–Ω–∞–ø—Ä. "–ê–ª–≥–µ–±—Ä–∞")        |
| `topic_name`      | `str`       | –¢–µ–º–∞ —É—Ä–æ–∫—É (–Ω–∞–ø—Ä. "–ö–≤–∞–¥—Ä–∞—Ç–Ω—ñ —Ä—ñ–≤–Ω—è–Ω–Ω—è") |
| `score_numeric`   | `int/float` | –û—Ü—ñ–Ω–∫–∞ (1-12)                           |
| `lesson_date`     | `datetime`  | –î–∞—Ç–∞ —É—Ä–æ–∫—É                              |

### `df_absences` (–ü—Ä–æ–ø—É—Å–∫–∏)

| –ö–æ–ª–æ–Ω–∫–∞           | –¢–∏–ø        | –û–ø–∏—Å                   |
| ----------------- | ---------- | ---------------------- |
| `student_id`      | `int`      | –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID —É—á–Ω—è     |
| `discipline_name` | `str`      | –ù–∞–∑–≤–∞ –ø—Ä–µ–¥–º–µ—Ç—É         |
| `topic_name`      | `str`      | –¢–µ–º–∞ –ø—Ä–æ–ø—É—â–µ–Ω–æ–≥–æ —É—Ä–æ–∫—É |
| `lesson_date`     | `datetime` | –î–∞—Ç–∞ –ø—Ä–æ–ø—É—Å–∫—É          |

---

## üöÄ 2. –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è

```python
from personalization_engine import PersonalizationEngine

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è (–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ —Å–µ—Ä–≤–µ—Ä–∞)
engine = PersonalizationEngine(df_scores, df_absences)

```

### –û—Å–Ω–æ–≤–Ω–∏–π –≤–∏–∫–ª–∏–∫ (`get_student_context`)

–ú–µ—Ç–æ–¥ –≥–µ–Ω–µ—Ä—É—î –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—á–Ω—è –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ–π —Ç–µ–º—ñ.

```python
context = engine.get_student_context(
    student_id=101,           # ID —É—á–Ω—è
    subject="–ê–ª–≥–µ–±—Ä–∞",        # –ü—Ä–µ–¥–º–µ—Ç
    topic_from_router="–í—ñ—î—Ç–∞" # –¢–µ–º–∞, —è–∫—É –∑–∞—Ä–∞–∑ –≤—á–∏–º–æ (–∑ Router)
)

```

---

## üì§ 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (JSON Output)

–ú–µ—Ç–æ–¥ –ø–æ–≤–µ—Ä—Ç–∞—î –±–∞–≥–∞—Ç–∏–π —Å–ª–æ–≤–Ω–∏–∫ (dictionary), —è–∫–∏–π —Ä–æ–∑–¥—ñ–ª–µ–Ω–∏–π –Ω–∞ –ª–æ–≥—ñ—á–Ω—ñ –±–ª–æ–∫–∏.

### –ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∞–ª—å–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:

```json
{
  "meta": {
    "student_id": 101,
    "subject": "–ê–ª–≥–µ–±—Ä–∞",
    "scope_type": "SPECIFIC_TOPIC", // –∞–±–æ "GENERAL_SUBJECT_FALLBACK"
    "is_fallback": false
  },
  "metrics": {
    "average_score": 4.5,
    "min_score": 2.0,
    "max_score": 8.0,
    "grades_count": 5
  },
  "enrichment": {
    // –ü–æ–≤–Ω–∏–π —Å–ª–æ–≤–Ω–∏–∫ –¥–ª—è –ø–æ–±—É–¥–æ–≤–∏ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –Ω–∞ Frontend
    "full_topic_breakdown": {
      "–¢–µ–æ—Ä–µ–º–∞ –í—ñ—î—Ç–∞ (—Ç–µ–æ—Ä—ñ—è)": 8.0,
      "–ö–≤–∞–¥—Ä–∞—Ç–Ω—ñ —Ä—ñ–≤–Ω—è–Ω–Ω—è (–ø—Ä–∞–∫—Ç–∏–∫–∞)": 2.0
    },
    "weak_topics": ["–ö–≤–∞–¥—Ä–∞—Ç–Ω—ñ —Ä—ñ–≤–Ω—è–Ω–Ω—è (–ø—Ä–∞–∫—Ç–∏–∫–∞)"],
    "strong_topics": ["–¢–µ–æ—Ä–µ–º–∞ –í—ñ—î—Ç–∞ (—Ç–µ–æ—Ä—ñ—è)"]
  },
  "attendance": {
    "missed_count": 1,
    "missed_lessons_details": ["2024-10-15: –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞"]
  },
  "prompt_injection": "..." // –ì–æ—Ç–æ–≤–∏–π —Ç–µ–∫—Å—Ç –¥–ª—è LLM
}
```

---

## ü§ñ 4. –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `prompt_injection`

–ü–æ–ª–µ `prompt_injection` –º—ñ—Å—Ç–∏—Ç—å –≥–æ—Ç–æ–≤–∏–π —ñ–Ω–∂–µ–Ω–µ—Ä–Ω–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –≤–∞—à–æ—ó LLM (Lapa/Mamay). –ü—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤—Ç–µ —Ü–µ–π —Ä—è–¥–æ–∫ —É —Å–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç –±–æ—Ç–∞.

**–í—ñ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–¥–∞–ø—Ç—É—î —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é:**

1. **–í–∏–∑–Ω–∞—á–∞—î –∞—Ä—Ö–µ—Ç–∏–ø:** "–°–ª–∞–±–∫–∏–π", "–°–∏–ª—å–Ω–∏–π", "–°–µ—Ä–µ–¥–Ω—ñ–π".
2. **–í—Ä–∞—Ö–æ–≤—É—î –ø—Ä–æ–≥–∞–ª–∏–Ω–∏:** –Ø–∫—â–æ —î –æ—Ü—ñ–Ω–∫–∏ < 6, –ø—Ä–æ—Å–∏—Ç—å –∑—Ä–æ–±–∏—Ç–∏ –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –Ω–∏—Ö.
3. **–í—Ä–∞—Ö–æ–≤—É—î –ø—Ä–æ–ø—É—Å–∫–∏:** –Ø–∫—â–æ —É—á–µ–Ω—å –ø—Ä–æ–ø—É—Å—Ç–∏–≤ —É—Ä–æ–∫, –¥–æ–¥–∞—î —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é _"–ü–æ—á–Ω–∏ –∑ —Ç–µ–æ—Ä—ñ—ó"_.

**–ü—Ä–∏–∫–ª–∞–¥ —Ç–µ–∫—Å—Ç—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ:**

> üìå –ö–û–ù–¢–ï–ö–°–¢: SPECIFIC_TOPIC (–í—ñ—î—Ç–∞).
> üî¥ –°–¢–ê–¢–£–°: –£—á–µ–Ω—å –°–õ–ê–ë–ö–ò–ô. –†—ñ–≤–µ–Ω—å: 4.5/12.
> ‚õî –ü–†–û–ü–£–©–ï–ù–Ü –£–†–û–ö–ò (1): [2024-10-15: –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞].
> ‚ö†Ô∏è –Ü–ù–°–¢–†–£–ö–¶–Ü–Ø –î–õ–Ø –í–ß–ò–¢–ï–õ–Ø: –ü–æ—è—Å–Ω—é–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ. –ö–†–Ü–ú –¢–û–ì–û: –£—á–µ–Ω—å –Ω–µ –±—É–≤ –Ω–∞ —Ü–∏—Ö —É—Ä–æ–∫–∞—Ö. –ü–æ—á–Ω–∏ –∑ –¢–ï–û–†–Ü–á.

---

## ‚öôÔ∏è 5. –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏ (Under the hood)

1. **–ü–æ—à—É–∫ —Ç–µ–º:**
   –ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `TfidfVectorizer` —Ç–∞ `Cosine Similarity`, —â–æ–± –∑–Ω–∞–π—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ –∑–∞–ø–∏—Å–∏ –≤ –∂—É—Ä–Ω–∞–ª—ñ. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ —Ç–µ–º—É _"–ö–≤–∞–¥—Ä–∞—Ç–Ω—ñ —Ä—ñ–≤–Ω—è–Ω–Ω—è"_, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤—á–∏—Ç–µ–ª—å –∑–∞–ø–∏—Å–∞–≤ —ó—ó —è–∫ _"–£—Ä–æ–∫ 15. –†—ñ–≤–Ω—è–Ω–Ω—è –≤–∏–¥—É ax^2..."_.
2. **Fallback Mode (–†–µ–∂–∏–º –ø–æ—Ä—è—Ç—É–Ω–∫—É):**
   –Ø–∫—â–æ —É—á–µ–Ω—å –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–≤—á–∞–≤ –∑–∞–ø–∏—Ç–∞–Ω—É —Ç–µ–º—É (–Ω–µ–º–∞—î –æ—Ü—ñ–Ω–æ–∫ —ñ –ø—Ä–æ–ø—É—Å–∫—ñ–≤), —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–º–∏–∫–∞—î—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º `GENERAL_SUBJECT_FALLBACK`.

- –í–æ–Ω–∞ –∞–Ω–∞–ª—ñ–∑—É—î **–≤–µ—Å—å –ø—Ä–µ–¥–º–µ—Ç** —Ü—ñ–ª–∫–æ–º.
- –í–∏–∑–Ω–∞—á–∞—î –∑–∞–≥–∞–ª—å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å —É—á–Ω—è.
- –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –Ω–∞ –æ—Å–Ω–æ–≤—ñ –π–æ–≥–æ –∑–∞–≥–∞–ª—å–Ω–æ—ó —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ.

3. **–ù–∞–∫–æ–ø–∏—á—É–≤–∞–ª—å–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è:**
   –°–∏—Å—Ç–µ–º–∞ –Ω–µ –æ–±–∏—Ä–∞—î _–æ–¥–Ω—É_ –ø—Ä–æ–±–ª–µ–º—É, –∞ –∫–æ–º–±—ñ–Ω—É—î —ó—Ö. –Ø–∫—â–æ —É—á–µ–Ω—å **–°–ª–∞–±–∫–∏–π** + **–ü—Ä–æ–≥—É–ª—è–≤** + **–ú–∞—î –ø–æ–≥–∞–Ω—ñ –æ—Ü—ñ–Ω–∫–∏ –∑–∞ —Å—Ö–æ–∂—É —Ç–µ–º—É** ‚Äî –±–æ—Ç –æ—Ç—Ä–∏–º–∞—î –≤—Å—ñ —Ç—Ä–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –æ–¥–Ω–æ—á–∞—Å–Ω–æ.
